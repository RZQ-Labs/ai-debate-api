<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="792px" preserveAspectRatio="none" style="width:906px;height:792px;background:#FFFFFF;" version="1.1" viewBox="0 0 906 792" width="906px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="27" x2="27" y1="81.2969" y2="711.9531"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="324" x2="324" y1="81.2969" y2="711.9531"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="503.5" x2="503.5" y1="81.2969" y2="711.9531"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="799.5" x2="799.5" y1="81.2969" y2="711.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="5" y="77.9951">Client</text><ellipse cx="27.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.5,21.5 L27.5,48.5 M14.5,29.5 L40.5,29.5 M27.5,48.5 L14.5,63.5 M27.5,48.5 L40.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="5" y="723.9482">Client</text><ellipse cx="27.5" cy="735.75" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.5,743.75 L27.5,770.75 M14.5,751.75 L40.5,751.75 M27.5,770.75 L14.5,785.75 M27.5,770.75 L40.5,785.75 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="277" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="284" y="69.9951">FastAPI App</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="277" y="710.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="284" y="730.9482">FastAPI App</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="178" x="414.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="421.5" y="69.9951">Auth (get_current_user)</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="178" x="414.5" y="710.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="421.5" y="730.9482">Auth (get_current_user)</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="704.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="711.5" y="69.9951">Database (AsyncSession)</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="704.5" y="710.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="711.5" y="730.9482">Database (AsyncSession)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="899.5" x="0" y="111.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="899.5" y1="111.8633" y2="111.8633"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="899.5" y1="114.8633" y2="114.8633"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="116" x="391.75" y="101.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="97" x="397.75" y="117.3638">Start Session</text><polygon fill="#181818" points="312.5,151.5625,322.5,155.5625,312.5,159.5625,316.5,155.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="27.5" x2="318.5" y1="155.5625" y2="155.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="34.5" y="150.4966">POST /api/v1/session/start (SessionCreate)</text><polygon fill="#181818" points="491.5,180.6953,501.5,184.6953,491.5,188.6953,495.5,184.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="324.5" x2="497.5" y1="184.6953" y2="184.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="331.5" y="179.6294">get_current_user(token)</text><polygon fill="#181818" points="787.5,209.8281,797.5,213.8281,787.5,217.8281,791.5,213.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="503.5" x2="793.5" y1="213.8281" y2="213.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="510.5" y="208.7622">SELECT user WHERE username=token.sub</text><polygon fill="#181818" points="514.5,238.9609,504.5,242.9609,514.5,246.9609,510.5,242.9609" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="508.5" x2="798.5" y1="242.9609" y2="242.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="520.5" y="237.895">User instance</text><polygon fill="#181818" points="335.5,268.0938,325.5,272.0938,335.5,276.0938,331.5,272.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="329.5" x2="502.5" y1="272.0938" y2="272.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="341.5" y="267.0278">User instance</text><polygon fill="#181818" points="787.5,297.2266,797.5,301.2266,787.5,305.2266,791.5,301.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="324.5" x2="793.5" y1="301.2266" y2="301.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="331.5" y="296.1606">INSERT INTO sessions (name, user_id, started_at)</text><polygon fill="#181818" points="335.5,326.3594,325.5,330.3594,335.5,334.3594,331.5,330.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="329.5" x2="798.5" y1="330.3594" y2="330.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="341.5" y="325.2935">New Session</text><polygon fill="#181818" points="38.5,355.4922,28.5,359.4922,38.5,363.4922,34.5,359.4922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="32.5" x2="323.5" y1="359.4922" y2="359.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="44.5" y="354.4263">200 OK (Session)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="899.5" x="0" y="388.0586"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="899.5" y1="388.0586" y2="388.0586"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="899.5" y1="391.0586" y2="391.0586"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="108" x="395.75" y="377.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="401.75" y="393.5591">End Session</text><polygon fill="#181818" points="312.5,427.7578,322.5,431.7578,312.5,435.7578,316.5,431.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="27.5" x2="318.5" y1="431.7578" y2="431.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="34.5" y="426.6919">POST /api/v1/session/end (session_id)</text><polygon fill="#181818" points="491.5,456.8906,501.5,460.8906,491.5,464.8906,495.5,460.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="324.5" x2="497.5" y1="460.8906" y2="460.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="331.5" y="455.8247">get_current_user(token)</text><polygon fill="#181818" points="787.5,486.0234,797.5,490.0234,787.5,494.0234,791.5,490.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="503.5" x2="793.5" y1="490.0234" y2="490.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="510.5" y="484.9575">SELECT user WHERE username=token.sub</text><polygon fill="#181818" points="514.5,515.1563,504.5,519.1563,514.5,523.1563,510.5,519.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="508.5" x2="798.5" y1="519.1563" y2="519.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="520.5" y="514.0903">User instance</text><polygon fill="#181818" points="335.5,544.2891,325.5,548.2891,335.5,552.2891,331.5,548.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="329.5" x2="502.5" y1="548.2891" y2="548.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="341.5" y="543.2231">User instance</text><polygon fill="#181818" points="787.5,573.4219,797.5,577.4219,787.5,581.4219,791.5,577.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="324.5" x2="793.5" y1="577.4219" y2="577.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="331.5" y="572.356">SELECT session WHERE id=session_id</text><polygon fill="#181818" points="335.5,602.5547,325.5,606.5547,335.5,610.5547,331.5,606.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="329.5" x2="798.5" y1="606.5547" y2="606.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="341.5" y="601.4888">Session instance</text><polygon fill="#181818" points="787.5,631.6875,797.5,635.6875,787.5,639.6875,791.5,635.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="324.5" x2="793.5" y1="635.6875" y2="635.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="331.5" y="630.6216">UPDATE session SET ended_at=now()</text><polygon fill="#181818" points="335.5,660.8203,325.5,664.8203,335.5,668.8203,331.5,664.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="329.5" x2="798.5" y1="664.8203" y2="664.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="341.5" y="659.7544">Updated Session</text><polygon fill="#181818" points="38.5,689.9531,28.5,693.9531,38.5,697.9531,34.5,693.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="32.5" x2="323.5" y1="693.9531" y2="693.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="44.5" y="688.8872">200 OK (Session)</text><!--MD5=[5959529d4731d696110f0f395d7a0fef]
@startuml
actor Client
participant "FastAPI App" as App
participant "Auth (get_current_user)" as Auth
participant "Database (AsyncSession)" as DB

== Start Session ==
Client -> App: POST /api/v1/session/start (SessionCreate)
App -> Auth: get_current_user(token)
Auth -> DB: SELECT user WHERE username=token.sub
DB - -> Auth: User instance
Auth - -> App: User instance
App -> DB: INSERT INTO sessions (name, user_id, started_at)
DB - -> App: New Session
App - -> Client: 200 OK (Session)

== End Session ==
Client -> App: POST /api/v1/session/end (session_id)
App -> Auth: get_current_user(token)
Auth -> DB: SELECT user WHERE username=token.sub
DB - -> Auth: User instance
Auth - -> App: User instance
App -> DB: SELECT session WHERE id=session_id
DB - -> App: Session instance
App -> DB: UPDATE session SET ended_at=now()
DB - -> App: Updated Session
App - -> Client: 200 OK (Session)
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>